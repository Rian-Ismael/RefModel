# RefModel

CLI tool that detects which **refactoring types** were applied between two code versions &mdash; either full files (“complete” mode) or code diffs (“diff” mode).  
Supports both a **local Ollama** model *or* the **Anthropic Claude API**.

---

## Repo layout

```
refmodel/
├── refModel_tool.py                 # main script
├── requirements.txt                 # Python dependencies
├── definitions/
│   └── refactoring_definitions.txt  # list of refactorings (one per line)
└── data/
    ├── input/                       # place your CSVs here
    └── output/                      # results generated by the script
```

---

## Installation

```bash
git clone https://github.com/Rian-Ismael/RefModel.git
cd refmodel

# (optional) virtual env
python3 -m venv .venv && source .venv/bin/activate

# Python libs
pip install -r requirements.txt
```

`requirements.txt` contains only what the script needs:

> **Heads‑up:**  
> - *Ollama backend*: requires the [Ollama runtime](https://ollama.com/) (`curl -fsSL https://ollama.com/install.sh | sh`).  
> - *Claude backend*: needs an **Anthropic API key** (see below).

---

## API‑key for Claude backend

The key is looked up **in this order**:

1. `--api_key YOUR_KEY` (command flag)  
2. Environment variable `ANTHROPIC_API_KEY`  
3. Line `ANTHROPIC_API_KEY=...` inside a local `.env` file (loaded if *python‑dotenv* is installed)  
4. Constant `DEFAULT_ANTHROPIC_API_KEY` hard‑coded in `refModel_tool.py` (empty by default).

### Using a `.env` file   <small>(recommended)</small>

```bash
# 1. install helper lib once
pip install python-dotenv

# 2. create .env in project root
echo 'ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxx' > .env

# 3. (optional) keep it out of Git
echo '.env' >> .gitignore
```

No need to export variables or pass `--api_key`; just run with `--backend claude`.

---

### Complete mode  (Ollama – default)

```bash
python3 refmodel/refModel_tool.py --mode complete --backend ollama \
  --csv artifacts/refmodel/data/input/my_complete.csv \
  --definitions refmodel/definitions/refactoring_definitions.txt \
  --out refmodel/data/output/complete_results.csv
```

*(You can omit `--backend ollama` and `--model` if you are OK with the default `phi4`.)*

### Diff mode  (Claude)

```bash
python3 refmodel/refModel_tool.py --mode diff --backend claude \
  --csv refmodel/data/input/my_diffs.csv \
  --definitions refmodel/definitions/refactoring_definitions.txt \
  --model claude-3-5-sonnet-20241022 \
  --out refmodel/data/output/diff_results.csv
```

If your definitions file stays at `definitions/refactoring_definitions.txt`,  
the `--definitions` flag may be omitted.

---

## Command‑line flags

| Flag | Default | Description |
|------|---------|-------------|
| `--backend` | **ollama** | `ollama` \| `claude` |
| `--mode` | *required* | `complete` \| `diff` |
| `--csv` | *required* | Input CSV path |
| `--definitions` | `definitions/refactoring_definitions.txt` | File with refactoring names/defs |
| `--model` | `phi4` | Ollama tag or Claude model id |
| `--temperature` | `0.6` | Sampling temperature |
| `--base_url` | `http://localhost:11434` | Ollama server URL |
| `--api_key` | _None_ | Claude key (falls back to env / .env) |
| `--max_tokens` | `1024` | Claude max tokens |
| `--out` | auto‑named | Output CSV path |
=======
```
--mode            complete | diff      (required)
--csv             path/to/input.csv    (required)
--definitions     path/to/defs.txt     (default: definitions/refactoring_definitions.txt)
--model           ollama model tag     (default: phi4)
--temperature     sampling temperature (default: 0.6)
--base_url        Ollama URL           (default: http://localhost:11434)
--out             path/to/output.csv   (auto‑generated if omitted)
```

---
